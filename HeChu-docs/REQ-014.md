# REQ-014: WinUI3 图像识别算法与原型对齐

## 状态
- [ ] 待开发
- [ ] 开发中
- [x] 已完成

## 创建信息
- 创建时间: 2026-02-12
- 最后更新: 2026-02-12
- 优先级: 高

## 需求描述
将 prototype/detect.py 的图像识别算法完全移植到 WinUI3 项目，确保识别结果与原型完全一致。包括网格检测、格子分类、元件检测、需求条检测等所有识别步骤。

## 边界条件
- 在 WinUI3 应用中，使用 .NET Configuration API + DI 容器进行配置管理，而非 TOML 文件
- 需要处理 Python → C# 的类型转换差异（如 OpenCV 数据类型）
- 需要考虑 OpenCV 版本差异（Python OpenCV vs Emgu.CV）
- 保持与原型相同的识别逻辑和参数配置

## 技术路线
1. 读取原型 detect.py 的完整识别流程和 config.py 的配置参数
2. 在 WinUI3 项目中创建配置模型类，使用 appsettings.json 存储参数
3. 在 WinUI3 的 PuzzleDetector.cs 中移植所有识别步骤
4. 使用 DI 容器注入配置服务
5. 对比原型和 WinUI3 的识别结果，确保完全一致

## 参考
- prototype/detect.py - 原型图像识别算法
- prototype/config.py - 原型配置加载模块
- prototype/config.toml - 原型配置文件
- WinUI3 项目现有的 PuzzleDetector.cs - 基础识别代码

## 相关文件
- `src/EndfieldPuzzleSolver.Recognition/Config/DetectionConfig.cs` - 新增：配置模型类
- `src/EndfieldPuzzleSolver.Recognition/ColorGrouper.cs` - 修改：添加 MatchNearest 方法，支持可配置的 HueMergeDistance
- `src/EndfieldPuzzleSolver.Recognition/PuzzleDetector.cs` - 修改：移植 detect.py 的完整识别算法
- `src/EndfieldPuzzleSolver/appsettings.json` - 新增：配置文件（从 config.toml 迁移）
- `src/EndfieldPuzzleSolver/ViewModels/MainViewModel.cs` - 修改：使用配置初始化 PuzzleDetector
- `src/EndfieldPuzzleSolver/EndfieldPuzzleSolver.csproj` - 修改：添加配置依赖和 appsettings.json
