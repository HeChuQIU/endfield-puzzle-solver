# REQ-026: ä¿®å¤ Web å‰ç«¯æœåŠ¡é…ç½®ç¼ºå¤±

**æ—¥æœŸ**: 2026-02-16  
**çŠ¶æ€**: âœ… å·²å®Œæˆ  
**å…³è”éœ€æ±‚**: REQ-023 (Web UI), REQ-025 (Docker éƒ¨ç½²)

## ğŸ“‹ éœ€æ±‚æ¦‚è¿°

ä¿®å¤ Blazor WebAssembly å‰ç«¯çš„å¯åŠ¨é…ç½®é—®é¢˜ï¼Œå‰ç«¯å› ç¼ºå°‘å¿…è¦çš„æœåŠ¡æ³¨å†Œå¯¼è‡´æ— æ³•è¿æ¥åˆ°åç«¯ APIã€‚

## ğŸ¯ é—®é¢˜ç°è±¡

- å‰ç«¯éƒ¨ç½²åæ‰“å¼€é¡µé¢æŠ¥é”™
- æ— æ³•è¿æ¥åˆ°åç«¯æœåŠ¡
- æµè§ˆå™¨æ§åˆ¶å°æ˜¾ç¤ºä¾èµ–æ³¨å…¥å¤±è´¥

## ğŸ” æ ¹æœ¬åŸå› 

[Program.cs](../src/EndfieldPuzzleSolver.Web/Program.cs) ç¼ºå°‘å¿…è¦çš„æœåŠ¡é…ç½®ï¼š

### ç¼ºå¤±çš„é…ç½®

1. **æœªæ³¨å†Œ `PuzzleApiClient` æœåŠ¡**
   - å‰ç«¯é¡µé¢é€šè¿‡ `@inject PuzzleApiClient Api` ä¾èµ–æ³¨å…¥
   - ä½† DI å®¹å™¨ä¸­æ²¡æœ‰æ³¨å†Œè¯¥æœåŠ¡
   - å¯¼è‡´è¿è¡Œæ—¶æŠ›å‡ºä¾èµ–æ³¨å…¥å¼‚å¸¸

2. **æœªé…ç½® `HttpClient` çš„ `BaseAddress`**
   - `PuzzleApiClient` ä¾èµ– `HttpClient` å‘é€è¯·æ±‚
   - ä½†æ²¡æœ‰é…ç½® `BaseAddress` æŒ‡å‘åç«¯ API åœ°å€
   - å¯¼è‡´ HTTP è¯·æ±‚å¤±è´¥

3. **æœªæ³¨å†Œ FluentUI æœåŠ¡**
   - å‰ç«¯é¡µé¢ä½¿ç”¨ `@inject IToastService Toast`
   - ä½†æ²¡æœ‰è°ƒç”¨ `AddFluentUIComponents()` æ³¨å†ŒæœåŠ¡
   - å¯¼è‡´ `IToastService` ç­‰æ¥å£æ— æ³•è§£æ

4. **æœªè¯»å– `appsettings.json` é…ç½®**
   - `wwwroot/appsettings.json` ä¸­é…ç½®äº† `ApiBaseUrl`
   - ä½† `Program.cs` æ²¡æœ‰è¯»å–è¯¥é…ç½®
   - å¯¼è‡´åç«¯åœ°å€é…ç½®æ— æ•ˆ

### åŸæœ‰ä»£ç ï¼ˆé”™è¯¯ï¼‰

```csharp
using EndfieldPuzzleSolver.Web;
using Microsoft.AspNetCore.Components.Web;
using Microsoft.AspNetCore.Components.WebAssembly.Hosting;

var builder = WebAssemblyHostBuilder.CreateDefault(args);
builder.RootComponents.Add<App>("#app");
builder.RootComponents.Add<HeadOutlet>("head::after");

await builder.Build().RunAsync();
```

## ğŸ”§ è§£å†³æ–¹æ¡ˆ

### 1. ä¿®å¤ Program.cs æœåŠ¡é…ç½®

ä¿®å¤åçš„ä»£ç ï¼š

```csharp
using EndfieldPuzzleSolver.Web;
using EndfieldPuzzleSolver.Web.Services;
using Microsoft.AspNetCore.Components.Web;
using Microsoft.AspNetCore.Components.WebAssembly.Hosting;
using Microsoft.FluentUI.AspNetCore.Components;

var builder = WebAssemblyHostBuilder.CreateDefault(args);
builder.RootComponents.Add<App>("#app");
builder.RootComponents.Add<HeadOutlet>("head::after");

// è¯»å–é…ç½®
var appSettings = builder.Configuration.GetSection("App").Get<AppSettings>() ?? new AppSettings();

// é…ç½® HttpClient æŒ‡å‘åç«¯ API
builder.Services.AddScoped(sp => 
{
    var client = new HttpClient { BaseAddress = new Uri(appSettings.ApiBaseUrl) };
    return client;
});

// æ³¨å†Œ API å®¢æˆ·ç«¯
builder.Services.AddScoped<PuzzleApiClient>();

// æ³¨å†Œ FluentUI æœåŠ¡
builder.Services.AddFluentUIComponents();

await builder.Build().RunAsync();
```

### 2. é…ç½®ç”Ÿäº§éƒ¨ç½²ï¼ˆHTTPSï¼‰

ç”±äºå‰ç«¯éƒ¨ç½²åœ¨ HTTPS (GitHub Pages)ï¼Œåç«¯ä¹Ÿå¿…é¡»ä½¿ç”¨ HTTPSï¼Œå¦åˆ™æµè§ˆå™¨ä¼šé˜»æ­¢æ··åˆå†…å®¹è¯·æ±‚ã€‚

#### åˆ›å»º docker-compose.yml

```yaml
version: '3.8'

services:ç”Ÿäº§ç¯å¢ƒåç«¯ API åœ°å€ï¼š

```json
{
  "App": {
    "ApiBaseUrl": "https://hechuqiu.net/"
  }
}
```

**è¯´æ˜**: ä½¿ç”¨ Caddy åå‘ä»£ç†ï¼ŒåŸŸåé€šè¿‡ DNS A è®°å½•æŒ‡å‘æœåŠ¡å™¨ IPï¼ŒCaddy è‡ªåŠ¨ç”³è¯·å’Œç®¡ç† SSL è¯ä¹¦ã€‚ image: caddy:latest
    restart: unless-stopped
    ports:
      - "80:80"
      - "443:443"
      - "443:443/udp"  # HTTP/3
    volumes:
      - ./Caddyfile:/etc/caddy/Caddyfile:ro
      - caddy_data:/data
      - caddy_config:/config
    networks:
      - app-network
    depends_on:
      - api

networks:
  app-network:

volumes:
  caddy_data:    # Caddy æ•°æ®ï¼ˆåŒ…å«è¯ä¹¦ï¼‰
  caddy_config:  # Caddy é…ç½®
```

#### åˆ›å»º Caddyfile

```
hechuqiu.net {
    reverse_proxy api:8080
    
    # CORS é…ç½®
    header {
        Access-Control-Allow-Origin *
        Access-Control-Allow-Methods "GET, POST, OPTIONS"
        Access-Control-Allow-Headers *
    }
    
    # æ—¥å¿—
    log {
        output stdout
        format console
    }
}
```

**ç‰¹ç‚¹**ï¼š
- âœ… Caddy è‡ªåŠ¨ç”³è¯· Let's Encrypt è¯ä¹¦
- âœ… è‡ªåŠ¨ç»­æœŸè¯ä¹¦ï¼ˆæ— éœ€æ‰‹åŠ¨ç®¡ç†ï¼‰
- âœ… HTTP è‡ªåŠ¨è·³è½¬ HTTPS
- âœ… æ”¯æŒ HTTP/3
- âœ… é…ç½® CORS å…è®¸å‰ç«¯è·¨åŸŸè®¿é—®

### 3. ä¿®å¤è¯´æ˜

1. **è¯»å–é…ç½®**: ä» `appsettings.json` çš„ `App` èŠ‚è¯»å– `ApiBaseUrl`
2. **é…ç½® HttpClient**: è®¾ç½® `BaseAddress` ä¸ºåç«¯ API åœ°å€
3. **æ³¨å†Œ API å®¢æˆ·ç«¯**: å°† `PuzzleApiClient` æ³¨å†Œä¸º Scoped æœåŠ¡
4. **æ³¨å†Œ FluentUI**: è°ƒç”¨ `AddFluentUIComponents()` æ³¨å†Œæ‰€æœ‰ FluentUI æœåŠ¡

### é…ç½®æ–‡ä»¶

[wwwroot/appsettings.json](../src/EndfieldPuzzleSolver.Web/wwwroot/appsettings.json) ä¸­é…ç½®åç«¯ API åœ°å€ï¼š

```json
{
  "App": {
    "ApiBaseUrl": "https://your-backend-api-url/"
  }
}
```

## âœ… éªŒè¯ç»“æœ

### ç¼–è¯‘çŠ¶æ€
- âœ… ç¼–è¯‘æˆåŠŸ (0 é”™è¯¯, 2 è­¦å‘Š)
- âš ï¸ è­¦å‘Š: `ConfigurationBinder.Get<T>` çš„ AOT å…¼å®¹æ€§è­¦å‘Šï¼ˆä¸å½±å“åŠŸèƒ½ï¼‰
ï¼ˆHTTPSï¼‰
- [ ] å¯ä»¥é€šè¿‡ HTTPS è¿æ¥åˆ°åç«¯ API
- [ ] æ‰“å¼€æˆªå›¾åŠŸèƒ½æ­£å¸¸
- [ ] ç²˜è´´æˆªå›¾åŠŸèƒ½æ­£å¸¸
- [ ] ç¤ºä¾‹åŠ è½½åŠŸèƒ½æ­£å¸¸
- [ ] Toast æç¤ºæ­£å¸¸æ˜¾ç¤º
- [ ] æ— æ··åˆå†…å®¹å®‰å…¨è­¦å‘Š
- [ ] ç¤ºä¾‹åŠ è½½åŠŸèƒ½æ­£å¸¸
- [ ] Toast æç¤ºæ­£å¸¸æ˜¾ç¤º

## ğŸ“¦ åç»­æ­¥éª¤
1. æœåŠ¡å™¨éƒ¨ç½²

åœ¨æœåŠ¡å™¨ä¸Šæ‰§è¡Œï¼ˆéœ€è¦ Docker å’Œ Docker Composeï¼‰ï¼š

```bash
# 1. åˆ›å»ºéƒ¨ç½²ç›®å½•
mkdir -p /opt/endfield-puzzle-solver
cd /opt/endfield-puzzle-solver

# 2. ä¸Šä¼  docker-compose.yml å’Œ Caddyfile

# 3. å¯åŠ¨æœåŠ¡
docker-compose up -d

# 4. æŸ¥çœ‹æ—¥å¿—ï¼ˆåŒ…å«è¯ä¹¦ç”³è¯·è¿‡ç¨‹ï¼‰
docker-compose logs -f caddy

# 5. æµ‹è¯• API
curl https://hechuqiu.net/api/health
```
æ–°å¢æ–‡ä»¶
- [docker-compose.yml](../docker-compose.yml) - Docker Compose é…ç½®
- [Caddyfile](../Caddyfile) - Caddy åå‘ä»£ç†å’Œ HTTPS é…ç½®
- [HeChu-docs/DEPLOYMENT.md](DEPLOYMENT.md) - å®Œæ•´éƒ¨ç½²æ–‡æ¡£

### ä¿®æ”¹æ–‡ä»¶
- [src/EndfieldPuzzleSolver.Web/Program.cs](../src/EndfieldPuzzleSolver.Web/Program.cs) - æ·»åŠ æœåŠ¡é…ç½®
- [src/EndfieldPuzzleSolver.Web/wwwroot/appsettings.json](../src/EndfieldPuzzleSolver.Web/wwwroot/appsettings.json) - é…ç½®ç”Ÿäº§ API åœ°å€

### 2. é‡æ–°å‘å¸ƒå‰ç«¯

```bash
# å‘å¸ƒå‰ç«¯åˆ° wwwroot
dotnet publish src/EndfieldPuzzleSolver.Web/EndfieldPuzzleSolver.Web.csproj -c Release -o publish/web

# éƒ¨ç½²åˆ° GitHub Pages
# å°† publish/web/wwwroot çš„å†…å®¹æ¨é€åˆ° gh-pages åˆ†æ”¯
```

### 3.
### éªŒè¯éƒ¨ç½²

1. è®¿é—®å·²éƒ¨ç½²çš„å‰ç«¯åœ°å€
2. æ‰“å¼€æµè§ˆå™¨å¼€å‘è€…å·¥å…· (F12)
3. æ£€æŸ¥ Console æ˜¯å¦æœ‰é”™è¯¯
4. æ£€æŸ¥ Network æ ‡ç­¾ï¼Œç¡®è®¤ API è¯·æ±‚æŒ‡å‘æ­£ç¡®åœ°å€
5. æµ‹è¯•ä¸Šä¼ æˆªå›¾åŠŸèƒ½

## ğŸ“š ç›¸å…³æ–‡ä»¶

### ä¿®æ”¹æ–‡ä»¶
- [src/EndfieldPuzzleSolver.Web/Program.cs](../src/EndfieldPuzzleSolver.Web/Program.cs) - æ·»åŠ æœåŠ¡é…ç½®

### ç›¸å…³æ–‡ä»¶ï¼ˆæœªä¿®æ”¹ï¼‰
- [src/EndfieldPuzzleSolver.Web/wwwroot/appsettings.json](../src/EndfieldPuzzleSolver.Web/wwwroot/appsettings.json) - API åœ°å€é…ç½®
- [src/EndfieldPuzzleSolver.Web/Services/PuzzleApiClient.cs](../src/EndfieldPuzzleSolver.Web/Services/PuzzleApiClient.cs) - API å®¢æˆ·ç«¯å®ç°
- [src/EndfieldPuzzleSolver.Web/AppSettings.cs](../src/EndfieldPuzzleSolver.Web/AppSettings.cs) - é…ç½®ç±»å®šä¹‰
- [src/EndfieldPuzzleSolver.Web/Pages/Index.razor](../src/EndfieldPuzzleSolver.Web/Pages/Index.razor) - ä¸»é¡µé¢ï¼ˆä½¿ç”¨ä¾èµ–æ³¨å…¥ï¼‰

## ğŸ’¡ ç»éªŒæ€»ç»“

### Blazor WebAssembly å¯åŠ¨é…ç½®æ£€æŸ¥æ¸…å•

1. âœ… **Root Components**: æ·»åŠ  `App` å’Œ `HeadOutlet`
2. âœ… **HttpClient**: é…ç½® `BaseAddress` æŒ‡å‘ API åœ°å€
3. âœ… **API Client**: æ³¨å†Œè‡ªå®šä¹‰ API å®¢æˆ·ç«¯æœåŠ¡
4. âœ… **UI Components**: æ³¨å†Œ UI ç»„ä»¶åº“æœåŠ¡ï¼ˆå¦‚ FluentUIï¼‰
5. âœ… **Configuration**: è¯»å– `appsettings.json` é…ç½®

### å¸¸è§é”™è¯¯

- âŒ å¿˜è®°æ³¨å†Œä¾èµ–æ³¨å…¥ä¸­ä½¿ç”¨çš„æœåŠ¡
- âŒ HttpClient æ²¡æœ‰é…ç½® BaseAddress
- âŒ é…ç½®æ–‡ä»¶å­˜åœ¨ä½†æœªè¯»å–
- âŒ UI ç»„ä»¶åº“æœåŠ¡æœªæ³¨å†Œ

### è°ƒè¯•æŠ€å·§

1. æµè§ˆå™¨ F12 Console æŸ¥çœ‹ JavaScript é”™è¯¯
2. Application æ ‡ç­¾æŸ¥çœ‹é™æ€èµ„æºåŠ è½½
3. Network æ ‡ç­¾æŸ¥çœ‹ API è¯·æ±‚åœ°å€
4. æ£€æŸ¥ `_framework/blazor.boot.json` ç¡®è®¤é…ç½®æ–‡ä»¶æ˜¯å¦æ‰“åŒ…

## ğŸ”— ç›¸å…³éœ€æ±‚

- REQ-023: Web UI è§†è§‰ä¼˜åŒ–ï¼ˆå‰ç«¯ç•Œé¢å¼€å‘ï¼‰
- REQ-024: Web æ‹–æ‹½åŠŸèƒ½ä¿®å¤ï¼ˆå‰ç«¯åŠŸèƒ½å¢å¼ºï¼‰
- REQ-025: Docker å®¹å™¨åŒ–éƒ¨ç½²ï¼ˆåç«¯éƒ¨ç½²ï¼‰
