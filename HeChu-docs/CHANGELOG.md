# 变更列表

记录所有需求的变更历史。

---

## REQ-001: 终末地源石电路模块解谜 - UI 识别原型
- [2026-02-10] 创建需求
- [2026-02-10] 完成开发：实现网格检测、格子分类、行列需求和元件检测的原型验证
- [2026-02-10] 优化行列需求检测：使用 Otsu 自适应阈值和变异系数（CV）判断，消除固定像素阈值依赖，提升对不同背景的鲁棒性

## REQ-002: 多分辨率与界面缩放支持
- [2026-02-10] 创建需求
- [2026-02-10] 完成开发：实现多尺度模板匹配自动探测 UI 缩放系数，支持 `--scale` 手动覆盖，并将核心像素阈值改为按缩放系数自适配

## REQ-003: WinUI 3 正式应用程序
- [2026-02-11] 创建需求
- [2026-02-11] 创建解决方案结构：3 个项目（WinUI 3 UI、C# 识别库、F# 算法库）
- [2026-02-11] 定义共享数据模型 PuzzleModels.cs
- [2026-02-11] 移植图像识别到 C#（PuzzleDetector + ColorGrouper）
- [2026-02-11] 创建 F# 算法骨架（Solver.fs + 分步记录模板 StepRecorder）
- [2026-02-11] 构建 WinUI 3 UI（CommandBar + Canvas 棋盘 + 侧边栏 + 步骤回放）
- [2026-02-11] 修复 XAML 编译器崩溃：`CommandBarSeparator` → `AppBarSeparator`（WinUI 3 正确控件名）
- [2026-02-11] 修复 HSV→RGB 转换（OpenCV H=0-180, S/V=0-255 范围适配）
- [2026-02-11] 修复 MatchTemplate 返回类型（`double` → `float`）
- [2026-02-11] 添加 `global.json` 固定 .NET 9 SDK（避免 .NET 10 SDK 兼容性问题）
- [2026-02-11] 全部 3 个项目构建成功（0 错误）
- [2026-02-12] 完成算法实现：递归回溯 + 约束传播剪枝，支持分步记录求解过程

## REQ-004: 需求数据模型修复（已满足/总需求显示）
- [2026-02-11] 创建需求
- [2026-02-11] 完成开发：修复 ColorRequirement.Count 仅统计未满足数量导致算法误判无解的 bug；Count 改为存储总需求数，新增 FilledCount 字段；UI 需求显示改为"已满足/总数"格式

## REQ-005: 拖拽图片支持 & 移除 JSON 导入
- [2026-02-11] 创建需求
- [2026-02-11] 完成开发：Canvas 区域支持拖入图片加载；移除 JSON 导入按钮及 ViewModel/code-behind 中所有相关代码

## REQ-006: 全页面接受图片拖入
- [2026-02-11] 创建需求
- [2026-02-11] 完成开发：拖拽区域从 Canvas Border 移至 RootGrid，全窗口均可接受图片拖入

## REQ-007: 元件形状可视化 & 棋盘元件区分
- [2026-02-11] 创建需求
- [2026-02-11] 完成开发：侧边栏用小方格矩阵展示元件原始形状；棋盘重构为两遍渲染，同一元件内部边框自动去除形成连通块

## REQ-009: 使用 component-flame 模板检测元件 UI
- [2026-02-12] 创建需求：通过 component-flame.png 模板匹配定位元件卡片边框，排除非游戏 UI 误检
- [2026-02-12] 完成开发：实现 component_flame 多尺度模板匹配；y 轴上限过滤排除底部 UI；模板无匹配时回退 blob 检测；puzzle2 元件 5 误检已消除

## REQ-010: 取色逻辑改为仅在识别出的元件上取色
- [2026-02-12] 创建需求：color_groups 仅从元件取样；锁格与需求条通过 match_nearest 匹配元件颜色
- [2026-02-12] 完成开发：检测顺序 grid→components→tiles→requirements；ColorGrouper.match_nearest；puzzle2 仅颜色 A

## REQ-011: 需求条按元件颜色相似度二值化检测
- [2026-02-12] 创建需求：每种元件颜色单独计算相似度图并二值化，按颜色检测需求条
- [2026-02-12] 完成开发：_similarity_map_for_color 按 Hue 相似度生成；_find_bars 按颜色循环检测；puzzle2 无误判 filled
